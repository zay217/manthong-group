<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><title>Car Loan Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* 让滑动条看起来更高级一点 */
        .form-range::-webkit-slider-thumb { background: var(--gold); }
        .form-range::-moz-range-thumb { background: var(--gold); }
    </style>
</head>
<body>
    <div class="bg-vibe"></div>
    <nav class="super-nav">
        <a href="index.html" class="nav-brand">CALCULATOR</a>
        <div class="nav-links"><a href="index.html">HOME</a></div>
    </nav>

    <div class="container" style="padding-top: 130px; max-width: 500px;">
        <div class="morph-card">
            <h2 class="fw-900 mb-4 text-center">LOAN CALCULATOR</h2>
            
            <div class="mb-3">
                <label>Car Price (RM)</label>
                <input type="number" id="price" class="form-control" placeholder="RM0.00" oninput="syncFromPercent()">
            </div>

            <div class="mb-3">
                <div class="d-flex justify-content-between">
                    <label>Down Payment (RM)</label>
                    <span id="percent-display" class="fw-bold text-warning">10%</span>
                </div>
                <input type="number" id="downpayment" class="form-control" placeholder="RM0.00" oninput="syncFromRM()">
                <input type="range" id="percent-range" class="form-range mt-2" min="0" max="100" step="1" value="10" oninput="syncFromPercent()">
            </div>

            <div class="mb-3">
                <label>Interest Rate (%)</label>
                <input type="number" step="0.01" id="interest" class="form-control" placeholder="3.8">
            </div>

            <div class="mb-3">
                <label>Period (Years)</label>
                <select id="years" class="form-select">
                    <option value="1">1 Years</option>
                    <option value="2">2 Years</option>
                    <option value="3">3 Years</option>
                    <option value="4">4 Years</option>
                    <option value="5">5 Years</option>
                    <option value="6">6 Years</option>
                    <option value="7">7 Years</option>
                    <option value="8">8 Years</option>
                    <option value="9" selected>9 Years</option>
                </select>
            </div>

            <button onclick="calculate()" class="btn-glow w-100 mt-3">CALCULATE NOW</button>

            <div id="result" class="mt-4 p-3 rounded-4 bg-white bg-opacity-50 text-center d-none">
                <p class="text-muted mb-1">Monthly Installment</p>
                <h2 class="fw-900 text-warning" id="monthly">RM 0.00</h2>
            </div>
        </div>
    </div>

    <script>
        // 自动从 URL 获取价格
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.get('price')) {
            document.getElementById('price').value = urlParams.get('price');
            // 获取到价格后，初始化头期金额（默认10%）
            syncFromPercent();
        }

        // 情况 A: 当滑动百分比，或者修改车价时 -> 自动算 RM
        function syncFromPercent() {
            const price = parseFloat(document.getElementById('price').value) || 0;
            const percent = document.getElementById('percent-range').value;
            
            // 计算金额
            const dpAmount = (price * (percent / 100)).toFixed(0);
            
            document.getElementById('downpayment').value = dpAmount;
            document.getElementById('percent-display').innerText = percent + '%';
        }

        // 情况 B: 当用户手动输入头期 RM -> 自动算百分比并移动拉条
        function syncFromRM() {
            const price = parseFloat(document.getElementById('price').value) || 0;
            const dpAmount = parseFloat(document.getElementById('downpayment').value) || 0;
            
            if (price > 0) {
                const percent = Math.round((dpAmount / price) * 100);
                // 限制在 0-100 之间
                const limitedPercent = Math.min(Math.max(percent, 0), 100);
                
                document.getElementById('percent-range').value = limitedPercent;
                document.getElementById('percent-display').innerText = limitedPercent + '%';
            }
        }

        // 最终计算月供（你的原始逻辑）
        function calculate() {
            const p = parseFloat(document.getElementById('price').value);
            const d = parseFloat(document.getElementById('downpayment').value) || 0;
            const r = parseFloat(document.getElementById('interest').value) / 100;
            const y = parseInt(document.getElementById('years').value);

            if(!p) { alert("Please enter car price"); return; }

            const loanAmount = p - d;
            const totalInterest = loanAmount * r * y;
            const monthly = (loanAmount + totalInterest) / (y * 12);

            document.getElementById('monthly').innerText = 'RM ' + monthly.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            document.getElementById('result').classList.remove('d-none');
        }
    </script>
</body>
</html>